<template>
  <div>
    <Modal
      :activeModal="store.state.department.addmodal"
      @close="closeModal"
      title="Create Department"
      centered
    >
      <form @submit.prevent="addDepartment" class="space-y-4">
        <Textinput
          label="title"
          type="text"
          placeholder="Department Name"
          name="title"
          v-model.trim="newTodoText"
          :error="newtodoError"
        />
        <div class="assagin space-y-4">
          <!-- <div class="grid lg:grid-cols-2 gap-4 grid-cols-1">
            <FormGroup label="Start Date" name="d1" :error="errorstartDate">
              <flat-pickr
                v-model="startDate"
                class="form-control"
                id="d1"
                placeholder="yyyy, dd M"
                :config="{
                  altInput: true,
                  altFormat: 'F j, Y',
                  dateFormat: 'Y-m-d',
                }"
              />
            </FormGroup>
            <FormGroup label="End Date" name="d2" :error="errorendDate">
              <flat-pickr
                v-model="endDate"
                class="form-control"
                id="d2"
                placeholder="yyyy, dd M"
                :config="{
                  altInput: true,
                  altFormat: 'F j, Y',
                  dateFormat: 'Y-m-d',
                }"
              />
            </FormGroup>
          </div>
          <VueSelect label="Assignee" :error="errorassign">
            <vSelect
              :options="assignOption"
              label="title"
              v-model="assign"
              multiple
            >
              <template #option="{ title, image }">
                <span class="flex items-center space-x-4">
                  <div class="flex-none">
                    <div class="h-7 w-7 rounded-full">
                      <img
                        :src="image"
                        alt=""
                        class="w-full h-full rounded-full"
                      />
                    </div>
                  </div>
                  <span class="flex-1">{{ title }}</span>
                </span>
              </template>
              <template #selected-option="{ title, image }">
                <span class="flex items-center space-x-4">
                  <div class="flex-none">
                    <div class="h-7 w-7 rounded-full">
                      <img
                        :src="image"
                        alt=""
                        class="w-full h-full rounded-full"
                      />
                    </div>
                  </div>
                  <span class="flex-1">{{ title }}</span>
                </span>
              </template>
            </vSelect>
          </VueSelect>

          <VueSelect label="Tag" :error="errorCategory"
            ><vSelect :options="options" v-model="category" multiple
          /></VueSelect> -->
          <Textarea
            label="Department description"
            placeholder="Department description"
            v-model="desc"
            :error="descoError"
          />

          <Select
            label="HOD"
            :options="roleOptions"
            v-model="hod"
            :error="hodError"
          />
        </div>

        <div class="text-right">
          <Button text="Add" btnClass="btn-dark"></Button>
        </div>
      </form>
    </Modal>
  </div>
</template>
<script setup>
import Select from "@/components/Select";
import Button from "@/components/Button";
// import FormGroup from "@/components/FormGroup";
import Modal from "@/components/Modal";
// import VueSelect from "@/components/Select/VueSelect";
import Textarea from "@/components/Textarea";
import Textinput from "@/components/Textinput";
import { v4 as uuidv4 } from "uuid";
import { useField, useForm } from "vee-validate";
// import vSelect from "vue-select";
import { useStore } from "vuex";
import * as yup from "yup";
// import { assignOption } from "@/constant/data";
let store = useStore();

// const options = [
//   {
//     value: "team",
//     label: "team",
//   },
//   {
//     value: "low",
//     label: "low",
//   },
//   {
//     value: "medium",
//     label: "medium",
//   },
//   {
//     value: "high",
//     label: "high",
//   },
// ];

const schema = yup.object({
  newTodoText: yup.string().required("Title is required"),
  desc: yup.string().required("Description is required"),

  category: yup.mixed().nullable().required("Please select category"),
  assign: yup.mixed().nullable().required("Please select One"),
  startDate: yup.string().required("Start date is required"),
  endDate: yup.string().required("End date is required"),
});
const { handleSubmit } = useForm({
  validationSchema: schema,
});
const { value: newTodoText, errorMessage: newtodoError } =
  useField("newTodoText");
const { value: desc, errorMessage: descoError } = useField("desc");

const { value: hod, errorMessage: hodError } = useField("hod");

// const { value: assign, errorMessage: errorassign } = useField("assign");
// const { value: startDate, errorMessage: errorstartDate } =
//   useField("startDate");
// const { value: endDate, errorMessage: errorendDate } = useField("endDate");

const addDepartment = handleSubmit(() => {
  store.dispatch("addDepartment", {
    id: uuidv4(),
    name: newTodoText.value,
    des: desc.value,
    // assignto: assign.value,
    // category: category.value.map((item) => item.value),
    // startDate: startDate.value,
    // endDate: endDate.value,
    progress: 40,
  });
});
const roleOptions = [
  { value: "admin", label: "John Jones" },
  { value: "hod", label: "Jane Jone" },
];

const closeModal = () => {
  store.dispatch("closeModal");
};
</script>
<style lang=""></style>
