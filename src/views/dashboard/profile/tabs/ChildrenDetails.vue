<template>
  <div>
    <Card bodyClass="p-0">
      <!-- <header
        class="border-b px-4 border-slate-100 dark:border-slate-700 pt-4 pb-3 flex justify-end items-center"
      >
      
      </header> -->
      <div class="p-6">
        <!-- {{ values }} -->
        <form @submit.prevent="pushDetails()" :validation-schema="schema">
          <div class="flex gap-x-8 mb-12">
            <div class="w-full lg:grid-cols-2 grid-cols-1 grid gap-5 last:mb-0">
              <Textinput
                :id="firstName"
                label="First Name"
                type="text"
                v-model="firstName"
                placeholder="Type your first name"
                :name="firstName"
                :error="firstNameError"
                classInput="h-[40px]"
              />

              <Textinput
                :id="lastName"
                label="Last Name"
                type="text"
                v-model="lastName"
                placeholder="Type your last name"
                :name="lastName"
                :error="lastNameError"
                classInput="h-[40px]"
              />

              <Textinput
                :id="middleName"
                label="Middle Name"
                type="text"
                v-model="middleName"
                placeholder="Type your middle name"
                :name="middleName"
                :error="middleNameError"
                classInput="h-[40px]"
              />

              <Textinput
                :id="email"
                label="Email Address"
                type="text"
                v-model="email"
                placeholder="Type your email address"
                :name="email"
                :error="emailError"
                classInput="h-[40px]"
              />

              <Textinput
                :id="mobile1"
                label="Mobile 1"
                type="text"
                v-model="mobile1"
                placeholder="Type your mobile number"
                :name="mobile1"
                :error="mobile1Error"
                classInput="h-[40px]"
              />

              <Textinput
                :id="mobile2"
                label="Mobile 2"
                type="text"
                v-model="mobile2"
                placeholder="Type your mobile 2"
                :name="mobile2"
                :error="mobile2Error"
                classInput="h-[40px]"
              />

              <CustomVueSelect
                :id="title"
                label="Title"
                v-model="title"
                :name="title"
                :modelValue="title"
                :error="titleError"
                :options="titleMenu"
                @update:modelValue="defaultSelectedValue = $event"
              />

              <CustomVueSelect
                :id="gender"
                label="Gender"
                v-model="gender"
                :name="gender"
                :modelValue="gender"
                :error="genderError"
                :options="genderMenu"
                @update:modelValue="defaultSelectedValue = $event"
              />

              <FromGroup label="DOB" name="d1">
                <flat-pickr
                  v-model="DOB"
                  class="form-control"
                  id="d1"
                  placeholder="yyyy, dd M"
                  :error="DOBError"
                />
              </FromGroup>
            </div>
            <div class="flex justify-between items-end space-x-5">
              <div class="flex-none relative">
                <!-- <button
                  type="button"
                  class="inline-flex items-center justify-center h-10 w-10 bg-danger-500 text-lg border rounded border-danger-500 text-white"
                  @click="remove(idx)"
                >
                  <Icon icon="heroicons-outline:trash" />
                </button> -->
                <div>
                  <Button
                    text="Add new"
                    icon="heroicons-outline:plus"
                    btnClass="btn-primary btn-sm"
                  />
                </div>
              </div>
            </div>
          </div>
        </form>

        <div @click="addDetail" class="ltr:text-right rtl:text-left">
          <Button text="Submit" btnClass="btn-dark" />
        </div>
      </div>
    </Card>
  </div>
</template>

<script setup>
// import Icon from "@/components/Icon";
import Card from "@/components/Card";
import Button from "@/components/Button";
import FromGroup from "@/components/FromGroup";
import Textinput from "@/components/Textinput";
import { useField, useForm } from "vee-validate";
import { titleMenu, genderMenu } from "@/constant/data";
import CustomVueSelect from "@/components/Select/CustomVueSelect.vue";

import * as yup from "yup";
import { ref } from "vue";
// import { useRouter } from "vue-router";

// Define a validation schema
const childrenDetails = ref([]);
const schema = yup.object({
  firstName: yup.string().required("First name is required"),
  lastName: yup.string().required("Last name is required"),
  middleName: yup.string(),
  email: yup.string().required("Email is required").email(),
  mobile1: yup.string(),
  mobile2: yup.string(),

  title: yup
    .object()
    .shape({
      value: yup.string().required("Title text is required"),
      label: yup.string(),
    })
    .nullable(),

  gender: yup
    .object()
    .shape({
      value: yup.string(),
      label: yup.string(),
    })
    .nullable(),
  DOB: yup.string(),
});

const formValues = {
  firstName: "",
  lastName: "",
  middleName: "",
  email: "",
  title: {
    value: "",
    label: "",
  },
  mobile1: "",
  mobile2: "",
  gender: {
    value: "",
    label: "",
  },
  DOB: "",
};

// const router = useRouter();

const { handleSubmit } = useForm({
  validationSchema: schema,
  initialValues: formValues,
});
// No need to define rules for fields

const { value: firstName, errorMessage: firstNameError } =
  useField("firstName");
const { value: lastName, errorMessage: lastNameError } = useField("lastName");
const { value: middleName, errorMessage: middleNameError } =
  useField("middleName");
const { value: email, errorMessage: emailError } = useField("email");
const { value: mobile1, errorMessage: mobile1Error } = useField("mobile1");
const { value: mobile2, errorMessage: mobile2Error } = useField("mobile2");

const { value: title, errorMessage: titleError } = useField("title");

const { value: gender, errorMessage: genderError } = useField("gender");

const { value: DOB, errorMessage: DOBError } = useField("DOB");

// const { remove, push, fields } = useFieldArray("childrenDetails");

// console.log(
//   firstName + lastName + middleName + email + mobile1 + mobile2 + title + DOB
// );

const resetForm = () => {
  formValues.firstName = "";
  formValues.lastName = "";
  formValues.middleName = "";
  formValues.email = "";
  formValues.title = {
    value: "",
    label: "",
  };
  formValues.mobile1 = "";
  formValues.mobile2 = "";
  formValues.gender = {
    value: "",
    label: "",
  };
  formValues.DOB = "";
};

const pushDetails = handleSubmit((values) => {
  console.log("PersonalDetails: " + JSON.stringify(values));
  childrenDetails.value.push(values);
  console.log("Children's Details" + JSON.stringify(childrenDetails.value));
  resetForm();
});

const addDetail = () => {
  console.log("PersonalDetails: " + JSON.stringify(childrenDetails.value));
};
</script>

<style lang="scss" scoped></style>
